---
title: Electron下多进程的选择
date: 2020-01-15 23:59:36
tags:
- Electron
---
# 多进程的必要性
开发一个桌面客户端应用，必然要面临一些场景需要通过多进程实现，比如需要进行非常重的计算，再比如需要异步的查询数据库，或者在后台需要建立socket通信。

Electron本身就分为两个进程：`主进程`和`渲染进程`，两个进程通过`rpc`互相通信，但是如果`主进程`阻塞，`渲染进程`也会阻塞，这就是为什么不要在`主进程`里执行重量级的数据运算等操作的原因。

# so 如何在Electron里实现多进程
目前来看有两种方式:
1. 使用NodeJs提供的Web workers
2. 在主进程里创建一个看不到的窗口(每个窗口都是一个单独的渲染进程)执行其他任务

# woker方式
worker 是从父进程创建出来后，就会执行创建时构造传入的JS脚本文件，并且worker是单独运行在另外的上下文中的，因此使用Web Worker这种方式有其本身的一些限制：
- worker无法访问dom
- worker无法使用Electron提供的模块
- worker不适合用来运行一些长期任务（像服务器进程一眼一直运行），适合运行一些运算量比较大的临时任务


# worker的例子
待补充...


# 隐藏的窗口方式
这个说白了就是创建一个看不见的窗口，每个窗口都有一个渲染进程，也算是曲线多进程了，你可以在这个渲染进程里干一些计算量比较大的任务之类的。
另外这种方式可以访问DOM元素，可以通过IPC方式跟主进程通信，但是这种方式相对而言更加占用资源。

在`main.js`入口文件中，通过指定参数可以创建一个隐藏的窗口
```
// create hidden worker window
  workerWindow = new BrowserWindow({
    show: false,
    webPreferences: { nodeIntegration: true }
  });
```

# 进程与进程间的通信方式
Electron并没有提供进程与进程间的通信方式，因此要采用很low的方式：
子进程发消息给主进程，主进程再根据消息内容传给对应的另外一个子进程


